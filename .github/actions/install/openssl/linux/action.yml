name: Install OpenSSL on Linux
description: Install and setup OpenSSL for linking and building test application
inputs:
  version:
    description: The desired OpenSSL version to install
    required: false
    default: "openssl-3.2.0"
runs:
  using: composite
  steps:
    - name: Cache OpenSSL
      id: cache-openssl
      uses: actions/cache@v3
      with:
        path: openssl-${{ inputs.version }}
        key: ${{ runner.name }}-${{ runner.os }}-${{ runner.arch }}-${{ job.container.id }}-openssl-${{ inputs.version }}

    - if: steps.cache-openssl.outputs.cache-hit != 'true'
      shell: bash
      run: |
        wget https://github.com/openssl/openssl/archive/refs/tags/${{ inputs.version }}.tar.gz
        tar -zxf ./${{ inputs.version }}.tar.gz
        cd openssl-${{ inputs.version }}
        ./config --prefix=${{ github.workspace }}/openssl --libdir=lib no-tests
        make -j $(nproc)

    - shell: bash
      run: |
        cd openssl-${{ inputs.version }}
        sudo make -j $(nproc) install_sw
        echo "OPENSSL_ROOT_DIR=${{ github.workspace }}/openssl" >> "$GITHUB_ENV"
        echo "OpenSSL_ROOT=${{ github.workspace }}/openssl" >> "$GITHUB_ENV"
